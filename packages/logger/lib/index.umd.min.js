!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rem={})}(this,function(e){"use strict";var n,i,t;function d(e,t){var n,o=t,r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(n in/(y+)/.test(t)&&(o=o.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+n+")").test(o)&&(o=o.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return o}(n=n||{}).EVENT="___alrale_logger_event___",(t=i=i||{}).LOCATION_URL="___alrale_logger_location_url___",t.SERVER_URL="___alrale_logger_server_url__",t.ENCRYPTION="___alrale_logger_encryption__";var s={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,r,a,i,d="",c=0;for(e=s._utf8_encode(e);c<e.length;)o=(i=e.charCodeAt(c++))>>2,r=(3&i)<<4|(t=e.charCodeAt(c++))>>4,a=(15&t)<<2|(n=e.charCodeAt(c++))>>6,i=63&n,isNaN(t)?a=i=64:isNaN(n)&&(i=64),d=d+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(i);return d},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}};var c=null;function l(){return new Promise(function(o){var r,e,t,n,a=window[i.LOCATION_URL.toString()];a?c?o(c):(e="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js",t=function(){window.$.ajax({url:a,type:"POST",dataType:"jsonp",success:function(e){var t=e.content.point,n=t.x,t=t.y,n=(new window.BMap.MercatorProjection).pointToLngLat(new window.BMap.Pixel(n,t)),t=n.lng,n=n.lat;r(),o(c={lng:t,lat:n,location:e})}})},(n=document.createElement("script")).src=e,n.onload=t,document.head.appendChild(n),r=function(){document.head.removeChild(n)}):o({err:"未配置"})})}function u(e){var t=window[i.ENCRYPTION.toString()],e=t?"useDefault"===t?s.encode(JSON.stringify(e)):t(e):e,e=new CustomEvent(n.EVENT,{detail:e,bubbles:!1,cancelable:!0});window.dispatchEvent(e)}function a(n,o,r,a){l().then(function(e){var t;u({eventType:"page",stateType:n,url:r,pageStatus:a,stayTime:o,createTime:d(new Date,"yyyy-MM-dd hh:mm:ss"),navigatorInfo:{userAgent:(t=navigator).userAgent,appCodeName:t.appCodeName,appName:t.appName,appVersion:t.appVersion,language:t.language,onLine:t.onLine,platform:t.platform,vendor:t.vendor},address:e})})}function o(){function e(n){var o=window.history,r=o[n];return function(){var e=r.apply(o,arguments),t=new Event(n);return window.dispatchEvent(t),e}}var o=Date.now(),r="";function t(e){var t,t="load"===e?0:(t=Date.now(),n=t-o,o=t,n),n=window.location.href;r&&a(e,t,r,"leave"),a(e,0,r=n,"enter")}history.pushState=e("pushState"),history.replaceState=e("replaceState"),window.addEventListener("load",function(e){t("load")}),window.addEventListener("popstate",function(e){t("popstate")}),window.addEventListener("pushState",function(e){t("pushState")}),window.addEventListener("replaceState",function(e){t("replaceState")})}function r(t){window.addEventListener(n.EVENT.toString(),function(e){t&&t(e)},!1)}e.handleClick=function(e){u({eventType:"click",content:e,url:window.location.href,createTime:d(new Date,"yyyy-MM-dd hh:mm:ss")})},e.handleCustom=function(e){u({eventType:"custom",content:e,url:window.location.href,createTime:d(new Date,"yyyy-MM-dd hh:mm:ss")})},e.listener=r,e.mount=function(e){var t=e.mapURI,n=e.serverURL,e=e.encryptionFunc;t&&(t=t,window[i.LOCATION_URL.toString()]=t),n&&(n=n,window[i.SERVER_URL.toString()]=n,r(function(e){var t;t=e.detail,(e=window[i.SERVER_URL.toString()])&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t}),mode:"cors"})})),e&&(e=e,window[i.ENCRYPTION.toString()]=e),o()},e.mountPageEvent=o,Object.defineProperty(e,"__esModule",{value:!0})});
