!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).logger={})}(this,function(e){"use strict";var o,a,t;function i(t){window.addEventListener(o.EVENT.toString(),function(e){t&&t(e)},!1)}function c(e,t){var n,o=t,r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(n in/(y+)/.test(t)&&(o=o.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+n+")").test(o)&&(o=o.replace(RegExp.$1,1==RegExp.$1.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return o}(o=o||{}).EVENT="___beeweb_logger_event___",(t=a=a||{}).TRACE_ID="___beeweb_trace_id___",t.LOCATION_URL="___beeweb_logger_location_url___",t.SERVER_URL="___beeweb_logger_server_url__",t.ENCRYPTION="___beeweb_logger_encryption__",t.STATEMENT="___beeweb_statement__";var d,s={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,r,i,a,c="",d=0;for(e=s._utf8_encode(e);d<e.length;)o=(a=e.charCodeAt(d++))>>2,r=(3&a)<<4|(t=e.charCodeAt(d++))>>4,i=(15&t)<<2|(n=e.charCodeAt(d++))>>6,a=63&n,isNaN(t)?i=a=64:isNaN(n)&&(a=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(a);return c},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}};function u(){return window[a.STATEMENT.toString()]||{}}function l(){return window[a.TRACE_ID.toString()]}function f(){return new Promise(function(o){var r,e,t,n,i=window[a.LOCATION_URL.toString()];i?d?o(d):(e="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js",t=function(){window.$.ajax({url:i,type:"POST",dataType:"jsonp",success:function(e){var t=e.content.point,n=t.x,t=t.y,n=(new window.BMap.MercatorProjection).pointToLngLat(new window.BMap.Pixel(n,t)),t=n.lng,n=n.lat;r(),o(d={lng:t,lat:n,location:e})}})},(n=document.createElement("script")).src=e,n.onload=t,document.head.appendChild(n),r=function(){document.head.removeChild(n)}):o({err:"未配置"})})}function p(e){var t,n={msie:!1,firefox:!1,opera:!1,safari:!1,chrome:!1,netscape:!1,appname:"unknown",version:0},o=window.navigator.userAgent.toLowerCase();switch(/(msie|firefox|opera|chrome|netscape)\D+(\d[\d.]*)/.test(o)?(n[RegExp.$1]=!0,n.appname=RegExp.$1,n.version=RegExp.$2):/version\D+(\d[\d.]*).*safari/.test(o)&&(n.safari=!0,n.appname="safari",n.version=RegExp.$2),e){case"name":t=n.appname;break;case"version":t=n.version;break;default:t=n.appname+" "+n.version}return t}function w(){var e="Unknown",t=navigator.userAgent.toLowerCase();return"Win32"!=navigator.platform&&"Windows"!=navigator.platform||(e="Windows"),"Mac68K"!=navigator.platform&&"MacPPC"!=navigator.platform&&"Macintosh"!=navigator.platform&&"MacIntel"!=navigator.platform||(e="Mac"),-1<t.indexOf("iphone")&&(e="iPhone"),-1<t.indexOf("ipod")&&(e="iPod"),-1<t.indexOf("ipad")&&(e="iPad"),e=-1<t.indexOf("linux")?-1<t.indexOf("Android")?"Android":"Linux":e}function r(t){if(!t)return"";if("object"!=={"[object String]":"string","[object Number]":"number","[object Boolean]":"boolean","[object Symbol]":"symbol","[object Undefined]":"undefined","[object Null]":"null","[object Function]":"function","[object Date]":"date","[object Array]":"array","[object Object]":"object","[object Map]":"map","[object RegExp]":"regexp","[object Error]":"error","[object HTMLDocument]":"document","[object global]":"window"}[Object.prototype.toString.call(t)])return"";var e=function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}(Object.keys(t).map(function(e){return t[e]?"".concat(e,"=").concat(t[e]):""})).join("&");return e?"?".concat(e):""}function n(e){var t=e.traceId,n=e.mapURI,o=e.serverURL,r=e.encryptionFunc,e=e.statement;t&&(t=t,window[a.TRACE_ID.toString()]=t),n&&(n=n,window[a.LOCATION_URL.toString()]=n),o&&(o=o,window[a.SERVER_URL.toString()]=o,i(function(e){var t;t=e.detail,(e=window[a.SERVER_URL.toString()])&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:t}),mode:"cors"})})),e&&(e=e,window[a.STATEMENT.toString()]=e),r&&(r=r,window[a.ENCRYPTION.toString()]=r)}function g(e){var t=window[a.ENCRYPTION.toString()],n=t?"useDefault"===t?s.encode(JSON.stringify(e)):t(e):e;"unload"===e.stateType&&(e=r({data:t=n}),(t=window[a.SERVER_URL.toString()])&&navigator.sendBeacon("".concat(t,"/async"),e));n=new CustomEvent(o.EVENT,{detail:n,bubbles:!1,cancelable:!0});window.dispatchEvent(n)}var h={};function _(e,t,n,o,r){g({eventType:"page",traceId:l(),statement:u(),stateType:e,url:n,pageStatus:o,stayTime:t,createTime:c(new Date,"yyyy-MM-dd hh:mm:ss"),kernel:p(),os:w(),address:r})}function m(t,n,o,r){window[a.LOCATION_URL.toString()]?f().then(function(e){_(t,n,o,r,h=e)}):new Promise(function(a){d?a(d):fetch("https://ipapi.co/json/").then(function(e){return e.json()}).then(function(e){var t=e.ip,n=e.latitude,o=e.longitude,r=e.version,i=e.region,e=e.city;a(d={ip:t,latitude:n,longitude:o,version:r,region:i,city:e})}).catch(function(e){a({err:"位置获取异常"})})}).then(function(e){_(t,n,o,r,h=e)})}function v(){function e(n){var o=window.history,r=o[n];return function(){var e=r.apply(o,arguments),t=new Event(n);return window.dispatchEvent(t),e}}var o=Date.now(),r="";function t(e){var t,t="load"===e?0:(t=Date.now(),n=t-o,o=t,n),n=window.location.href;"unload"!==e?(r&&m(e,t,r,"leave"),m(e,0,r=n,"enter")):_(e,t,n,"leave",h)}window.history.pushState=e("pushState"),window.history.replaceState=e("replaceState"),window.addEventListener("load",function(e){t("load")}),window.addEventListener("unload",function(e){t("unload")}),window.addEventListener("popstate",function(e){t("popstate")}),window.addEventListener("pushState",function(e){t("pushState")}),window.addEventListener("replaceState",function(e){t("replaceState")})}e.handleClick=function(e){g({eventType:"click",traceId:l(),statement:u(),content:e,url:window.location.href,kernel:p(),os:w(),createTime:c(new Date,"yyyy-MM-dd hh:mm:ss"),address:h})},e.handleCustom=function(e){g({eventType:"custom",traceId:l(),statement:u(),content:e,url:window.location.href,kernel:p(),os:w(),createTime:c(new Date,"yyyy-MM-dd hh:mm:ss"),address:h})},e.listener=i,e.mount=function(e){e&&n(e),v()},e.mountPageEvent=v,Object.defineProperty(e,"__esModule",{value:!0})});
